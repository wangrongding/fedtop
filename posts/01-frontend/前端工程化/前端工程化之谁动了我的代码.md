---
title: è°åŠ¨äº†æˆ‘çš„ä»£ç !
date: 2022-02-13
tags:
  - JavaScript
categories:
  - å‰ç«¯
---

![](https://assets.fedtop.com/picbed/202205112257599.png)

å½“ä½ æŸä¸€å¤© fetch ä»£ç æ—¶ï¼Œå‘ç°å¾ˆå¤šæ–‡ä»¶æ˜¯è¿™æ ·çš„ ğŸ‘† ä½ æ˜¯ä¸æ˜¯å¾ˆå´©æºƒï¼Ÿ

<!-- more -->

## å‰è¨€

å…¬å¸ä¸€ä¸ªè€é¡¹ç›®ï¼Œæ²¡æœ‰åšä»£ç æäº¤å‰çš„è§„èŒƒæ ¡éªŒï¼Œæˆ‘æ‹¿åˆ°åï¼Œæƒ³ç€è€é¡¹ç›®å˜›ä¹Ÿæ²¡æ—¶é—´å¸®å®ƒå¼„è¿™äº›ï¼Œåæ­£å°±æ˜¯æ”¹ä¸€ç‚¹ç‚¹å°ä¸œè¥¿ï¼›å°½é‡è·Ÿç€å®ƒçš„ä»£ç é£æ ¼å†™ï¼Œå†™å®Œæäº¤å°±è¡Œï¼›

ç›´åˆ°æŸä¸€å¤©ï¼Œåˆæœ‰ä¸€ä¸ªäººåŠ å…¥äº†è¿›æ¥ã€‚å¥½å®¶ä¼™ï¼Œç›´æ¥å¹²å‡ºäº‹äº†ã€‚  
å¾ˆå¤šä¸ªæ–‡ä»¶ä¸€èµ·æäº¤çš„ï¼Œç„¶å commit-msg ä¸è§„èŒƒï¼Œä»£ç ç¼©è¿›ä¹Ÿä¸è§„èŒƒï¼Œæ¢è¡Œç¬¦ä¹Ÿä¸ä¸€è‡´ï¼Œé‡Œé¢è¿˜æœ‰å¾ˆå¤šæ²¡ç”¨çš„ä»£ç ï¼Œå¯è¯»æ€§æå·®ï¼›

ä½†é—®é¢˜ç»ˆå½’æ˜¯å¾—å»è§£å†³çš„ï¼›æ²»ç†æ±¡æ°´çš„æœ€å¥½æ–¹æ³•å°±æ˜¯ä»èƒ½æ±¡æ°´äº§ç”Ÿçš„åœ°æ–¹å¼€å§‹æ•´æ²»ã€‚æˆ‘æ¥å¸®å®ƒåŠ ä¸Šå§ã€‚ğŸ¥°

ä¸‹é¢æˆ‘å°†å¸¦å¤§å®¶ä¸€èµ·ï¼Œå…ˆé€šè¿‡`husky`+`eslint`å®Œæˆä¸€ä¸ªæœ€ç®€å•çš„ä»£ç è§„èŒƒæ ¡éªŒï¼Œç„¶åé€æ­¥ä¼˜åŒ–ï¼Œæœ€åé€šè¿‡`husky`+`eslint`+`lint-stage`+`commitlint`+`pritter`å®ç°ä¸€ä¸ªå¼ºæœ‰åŠ›çš„é™åˆ¶ã€‚æœ€åå†é…åˆ`commitizen`,é€šè¿‡`commitlint-config-cz`+`cz-customizable`å®ç°è‡ªå®šä¹‰çš„æäº¤æ¨¡æ¿å’Œé™åˆ¶è§„åˆ™æ¥å®ç°å›¢é˜Ÿæœ€ç»ˆçš„`é¡¹ç›®æäº¤é™åˆ¶è§„çº¦`ã€‚

## eslit+pritter

è¿™é‡Œæˆ‘ä¸ºè¯¥é¡¹ç›®é€‚é…äº†ä¸€å¥— eslit è§„åˆ™ï¼ŒæŒ‰ç…§è¿™å¥—è§„åˆ™æäº¤çš„ä»£ç ä¸ä¼šæœ‰å†²çªã€‚  
eslint å’Œ pritter å¤§å®¶å¹³æ—¶é¡¹ç›®åº”è¯¥éƒ½ç”¨åˆ°è¿‡ï¼Œåº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè¿™é‡Œå°†ä¸å ç”¨ç¯‡å¹…ã€‚(æƒ³çœ‹çš„å¯ä»¥ç§èŠæˆ‘ï¼Œæˆ‘å¯ä»¥å•ç‹¬å‡ºä¸€ç¯‡ eslint å’Œ pritter ä¸»é¢˜çš„æ–‡ç« )

ğŸ¦„ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦è®²è§£å¦‚ä½•åœ¨å›¢é˜ŸååŒå·¥ä½œæ—¶ï¼Œåœ¨ git æäº¤ä»£ç æ›´æ”¹å‰ï¼Œå¯¹ä¸è§„èŒƒçš„ä»£ç å’Œæäº¤ä¿¡æ¯è¿›è¡Œæ ¡éªŒï¼Œä¿®å¤ï¼Œå¹¶é™åˆ¶ä¸è§„èŒƒçš„æäº¤ã€‚

## husky

é¦–å…ˆè¦ä»‹ç»çš„æ˜¯`husky`ï¼Œæå·¥ç¨‹åŒ–ï¼Œæˆ‘ä»¬è‚¯å®šéƒ½å°‘ä¸äº† `husky`ï¼Œå®ƒèƒ½å¾ˆæ–¹ä¾¿çš„å¸®æˆ‘ä»¬é˜»æŒ¡å°å¯çˆ±ä»¬çš„è¿›æ”»ï¼Œä¸ï¼Œæ˜¯ä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ `git hooks`

### å…·ä½“æ–¹æ³•

é¦–å…ˆæˆ‘ä»¬å°† `husky` å®‰è£…åˆ°å¼€å‘ä¾èµ–ä¸­

```sh
npm i husky -D
# or
yarn add husky -D
```

> ### æ³¨æ„
>
> ç›®å‰æˆ‘æ‰€å®‰è£…çš„ç‰ˆæœ¬æ˜¯`husky@7.0.4`,ç”±äº`husky@6.0.0` ååšäº†`breaking change`ï¼Œæ‰€ä»¥åœ¨`6.0.0`ç‰ˆæœ¬ä¹‹å‰çš„é‚£ç§è®¾ç½®é’©å­çš„æ–¹æ³•å·²ç»ä¸é€‚ç”¨äº†,**è¿™é‡Œæˆ‘ä»¬åªä»‹ç»æœ€æ–°çš„æ–¹å¼**ã€‚

å®‰è£…å®Œåï¼Œæˆ‘ä»¬éœ€è¦åœ¨å½“å‰é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª`.husky`ç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º `git hooks` æ‰€åœ¨çš„ç›®å½•ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º ğŸ‘‡

```sh
#--no-install å‚æ•°è¡¨ç¤ºå¼ºåˆ¶npxä½¿ç”¨é¡¹ç›®ä¸­node_modulesç›®å½•ä¸‹çš„huskyä¾èµ–åŒ…
npx --no-install husky install
```

ä¸ºäº†è®©å…¶ä»–äººåœ¨æ­¤é¡¹ç›®ä¸­å®‰è£…ä¾èµ–åä¹Ÿèƒ½è‡ªåŠ¨åˆ›å»º`.husky`ç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º `git hooks` æ‰€åœ¨çš„ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `package.json` é‡Œé¢æ·»åŠ ä¸€æ¡è„šæœ¬`"prepare": "husky install"`

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿæ·»åŠ  ğŸ‘‡

```sh
npm set-script prepare "husky install"
```

> `prepare` è„šæœ¬ä¼šåœ¨ `npm i`æˆ–è€…å…¶ä»–`yarn or yarn add` ä¹‹åè‡ªåŠ¨æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬å®‰è£…ä¾èµ–åä¼šè‡ªåŠ¨æ‰§è¡Œ `husky install` å‘½ä»¤ï¼Œä»è€Œè‡ªåŠ¨åˆ›å»º`.husky`ç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º `git hooks` æ‰€åœ¨çš„ç›®å½•ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º ğŸ‘‡

```sh
npx --no-instal husky add .husky/pre-commit "npm run [ä½ è¦æ‰§è¡Œçš„å‘½ä»¤]"
```

å®Œæˆåå¯ä»¥çœ‹åˆ°`.husky`ç›®å½•ä¸‹æ–°å¢äº†ä¸€ä¸ª`pre-commit`æ–‡ä»¶,å…¶ä¸­çš„å†…å®¹ä¸º ğŸ‘‡ ![](https://assets.fedtop.com/picbed/20220511230859.png)

è¿™é‡Œæˆ‘ç”¨çš„æ˜¯`npm run lint`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é…åˆ Eslint çš„ä»£ç æ ¡éªŒ,æ¥é™åˆ¶ä¸è§„èŒƒä»£ç çš„æäº¤äº†

![](https://assets.fedtop.com/picbed/20220511230918.png) å¯ä»¥çœ‹åˆ°ï¼Œä¸ç¬¦åˆ Eslint æ ¡éªŒè§„åˆ™çš„ä»£ç æ˜¯æ²¡æ³•æäº¤çš„ï¼›

å½“ç„¶ï¼Œè¿™é‡Œçš„æŠ¥é”™é—®é¢˜åªæ˜¯ç”±äºç¼©è¿›ä¸è§„èŒƒå¼•èµ·çš„ï¼Œç±»ä¼¼è¿™ç§çš„é—®é¢˜è¿˜æœ‰å¼•å·ï¼Œå¥å°¾åˆ†å·ï¼Œæ¢è¡Œç¬¦ç­‰ç­‰...éƒ½å¯ä»¥é€šè¿‡ `eslint` çš„å‚æ•° `--fix`æ¥è‡ªåŠ¨ä¿®å¤ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æäº¤å‰ï¼Œå…ˆå°†èƒ½å®ç°è‡ªåŠ¨ä¿®å¤çš„ç®€å•ä»£ç é£æ ¼é—®é¢˜å commitã€‚å¤æ‚çš„æƒ…å†µè¿˜æ˜¯è¦è‡ªå·±å»æ‰‹åŠ¨å¤„ç†çš„ã€‚

> è¯´åˆ°æ¢è¡Œç¬¦ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯ï¼šåœ¨ Windows ä¸Šé»˜è®¤çš„æ˜¯å›è½¦æ¢è¡Œï¼ˆCarriage Return Line Feed, CRLFï¼‰ï¼Œç„¶è€Œï¼Œåœ¨ Linux/MacOS ä¸Šåˆ™æ˜¯æ¢è¡Œï¼ˆLine Feed, LFï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹å°†åŸå…ˆæ¢è¡Œç¬¦ä¸º`crlf`çš„æ–‡ä»¶æ ¼å¼åŒ–ä¸ºæ¢è¡Œç¬¦ä¸º`lf`åï¼Œæ‰§è¡Œ`git add .`çš„æƒ…å†µã€‚

![](https://assets.fedtop.com/picbed/20220511230937.png)

å¯ä»¥çœ‹åˆ°æœ€ç»ˆ LF æ¢è¡Œç¬¦è¿˜æ˜¯è¢« CRLF è½¬åŒ–äº†ï¼›

å¦‚æœä½ ä»¬ä¸ä¼šè·¨å¹³å°åä½œï¼ˆéƒ½åœ¨ Mac/Linuxï¼Œæˆ–è€…éƒ½åœ¨ Windows ä¸ŠååŒï¼‰ï¼Œåªéœ€è¦åœ¨å½“å‰é¡¹ç›®ä¸­é€šè¿‡`git config core.autocrlf false`æ¥é˜»æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚

ä¸ºäº†ä¿é™©èµ·è§ï¼Œä½ éœ€è¦æ–°å»ºä¸€ä¸ª`.gitattributes`æ–‡ä»¶ï¼ˆä¸»è¦ç”¨äºå®šä¹‰æ¯ç§æ–‡ä»¶çš„å±æ€§ï¼Œä»¥æ–¹ä¾¿ git å¸®æˆ‘ä»¬ç»Ÿä¸€ç®¡ç†ã€‚ï¼‰ï¼Œè®¾ç½® eol(end of line)ä¸ºæŒ‡å®šçš„æ¢è¡Œç¬¦ï¼ˆlf/crlfï¼‰ï¼Œè¿™é‡Œæˆ‘æŠŠæ‰€æœ‰æ–‡ä»¶`*.*`çš„æ¢è¡Œç¬¦éƒ½è®¾ç½®ä¸ºäº† LFï¼Œå¹¶ä¸”å°†ä¸€äº›éæ–‡æœ¬æ–‡ä»¶è¿›è¡Œäº†æ ‡è®°ï¼ˆæ’é™¤å®ƒä»¬ï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹æ¯ä¸€ç§æ–‡ä»¶ç±»å‹åˆ†åˆ«è®¾ç½®å¯¹åº”çš„å±æ€§ => `*.js eol=lf`ï¼Œ`*.ts eol=lf`...

```sh
*.* eol=lf
*.jpg -text
*.png -text
  ...
# æˆ–è€…ğŸ‘‡

*.js eol=lf
*.ts eol=lf
*.json eol=lf
  ...
```

æ–‡ä»¶å†…å®¹å¦‚ä¸‹ ğŸ‘‡

![](https://assets.fedtop.com/picbed/20220511230953.png)

è¿™æ ·ï¼Œæˆ‘ä»¬ä¸ç®¡åœ¨ä»€ä¹ˆå¹³å°ä¸Šå¼€å‘ï¼Œæ–‡ä»¶æ¢è¡Œç¬¦éƒ½ç»Ÿä¸€ä¸º LFã€‚

å¯ä»¥çœ‹åˆ°ä½¿ç”¨`.gitattributes`é…ç½®æ–‡ä»¶åæ‰§è¡Œ`git add`,æ‰€æœ‰ä¸æ˜¯æŒ‡å®šæ¢è¡Œç¬¦çš„æ–‡ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨æ›´æ¢ä¸ºä½ æŒ‡å®šçš„æ¢è¡Œç¬¦ï¼Œä¾‹å¦‚æˆ‘è¿™é‡ŒæŒ‡å®šäº†`lf`,é‚£ä¹ˆ `git add .` åï¼Œä¸æ˜¯ä»¥ `lf` æ¢è¡Œçš„æ–‡ä»¶éƒ½ä¼šè¢«è½¬æ¢ä¸º `lf` ï¼Œå¹¶åœ¨ç»ˆç«¯è¾“å‡º`warning: CRLF will be replaced by LF in xxxx/filename`ï¼Œå¦‚å›¾ ğŸ‘‡

![](https://assets.fedtop.com/picbed/20220511231002.png)

`.gitattributes`æœ‰å¾ˆå¤šç”¨å¤„ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ ğŸ‘‰[gitattributes](https://git-scm.com/docs/gitattributes)ï¼Œï¼ˆä½†æ˜¯åœ¨è¿™é‡Œä¸æ˜¯æœ€ä½³å®è·µï¼ï¼‰

ğŸ¥° åˆ°è¿™é‡Œï¼Œä¸€ä¸ªæœ€ç®€å•çš„ä»£ç é£æ ¼é™åˆ¶æ–¹æ³•å°±å·²ç»å®ç°äº†ã€‚

æ—¢ç„¶åšäº†ï¼Œå°±è‚¯å®šè¦åšä¸€å¥—å®Œæ•´çš„ï¼Œä¸”å¥½ç”¨çš„ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç»§ç»­å®Œå–„å…¶ä»–åŠŸèƒ½ ~

---

## lint-staged

ä»€ä¹ˆæ˜¯`lint-staged`?é¡¾åæ€ä¹‰ï¼Œå€ŸåŠ©è¿™ä¸ªå·¥å…·åªæ˜¯ç”¨æ¥æ£€æŸ¥ git æš‚å­˜åŒºæ–‡ä»¶çš„ï¼Œå°±æ˜¯åœ¨ä½ `git add file1ï¼Œ2ï¼Œ3...` åçš„æš‚å­˜åŒºæ–‡ä»¶ä¸­è¿è¡Œ `lint` çš„ä¸€ä¸ªå·¥å…·ã€‚

æ¯æ¬¡æäº¤ä¸€ä¸¤ä¸ªæ–‡ä»¶ï¼Œå´éƒ½è¦ `lint` æ‰€æœ‰æ–‡ä»¶è¯ï¼Œæ˜¯å¾ˆæ²¡æœ‰å¿…è¦çš„ï¼Œæˆ‘ä»¬åªå¯¹éœ€è¦æäº¤çš„ä»£ç è¿›è¡Œ `lint`,è¿™æ ·å¯ä»¥å‡å°‘å¾ˆå¤šæ²¡å¿…è¦çš„æ—¶é—´å¼€é”€ã€‚ï¼ˆå¦‚æœä½ æ¯æ¬¡ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œéƒ½è¦å» `lint` æ‰€æœ‰æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·å¯¹ä½ æ¥è¯´å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ï¼Œ`husky` å°±ç®¡å¤Ÿ ğŸ¤ï¼‰

### å®‰è£…

```sh
yarn add lint-staged -D
```

### ä½¿ç”¨æ–¹æ³•

æˆ‘ä»¬å°†`.husky/pre-commit`ä¸­ä¹‹å‰å†™ä»£ç æ”¹ä¸º ğŸ‘‡

```diff
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"
- npm run lint
+ npx --no-install lint-staged
```

ç„¶ååœ¨ package.json ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ,`lint-staged`å¯¹è±¡ä¸­é‡‡ç”¨é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œé”®åæ˜¯ä½ æƒ³å¤„ç†çš„å•ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªæ–‡ä»¶ç±»å‹ï¼Œå¤šä¸ªç±»å‹å¯ä»¥å†™åœ¨`{}`ä¸­ï¼Œç”¨é€—å·åˆ†éš”ï¼›é”®å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­ä¸º lint æ—¶éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ç»„ã€‚

```json
{
  "lint-staged": {
    "*.{ts,js,vue}": ["eslint", "echo 'æ²¡é—®é¢˜ï¼'"]
  }
}
```

æ·»åŠ ç©ä¸Šè¿°ä»£ç åï¼Œæˆ‘ä»¬é€šè¿‡æµ‹è¯•ï¼Œå°†ä¸¤ä¸ªæ–‡ä»¶çš„ç¼©è¿›æ”¹ä¸ºä¸ç¬¦åˆè§„èŒƒçš„æƒ…å†µï¼Œç„¶åå°†å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶æš‚å­˜åï¼Œæˆ‘ä»¬è¿è¡Œ`git commit`åå‘ç°ç»ˆç«¯çš„æŠ¥é”™ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶çš„ `lint` æŠ¥é”™ä¿¡æ¯,å¦ä¸€ä¸ªæ–‡ä»¶çš„æŠ¥é”™å¹¶æ²¡æœ‰å‡ºç°ã€‚

![](https://assets.fedtop.com/picbed/20220511231137.png)

å½“æ‰€æœ‰æš‚å­˜åŒºä»£ç éƒ½ç¬¦åˆè§„èŒƒæ—¶ ğŸ‘‡ï¼Œæ‰ä¼šé€šè¿‡æ ¡éªŒæ‰§è¡Œæäº¤ã€‚

```sh
âœ” Preparing lint-staged...
âœ” Hiding unstaged changes to partially staged files...
âœ” Running tasks for staged files...
âœ” Restoring unstaged changes to partially staged files...
âœ” Cleaning up temporary files...
```

## commitizen

Commitizen æ˜¯ä¸€ä¸ªæ’°å†™ç¬¦åˆä¸Šé¢ Commit Message æ ‡å‡†çš„ä¸€æ¬¾å·¥å…·ã€‚é€šè¿‡å®ƒå¯ä»¥å®ç°äº¤äº’å¼æ’°å†™è§„èŒƒçš„ Commit Messageã€‚

![](https://assets.fedtop.com/picbed/202202130119061.gif)

å¦‚æœåªåœ¨æœ¬ä»“åº“ä½¿ç”¨ ğŸ‘‡

```sh
npm install commitizen -D
# or
yarn add commitizen -D
```

å¦‚æœä½ æƒ³å…¨å±€éƒ½ç”¨ commitizen æ¥å¸®ä½ åš commit

```sh
npm install commitizen -g
# or
yarn global add commitizen
```

å®‰è£…å®Œæˆåï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½é‡‡ç”¨ç¬¦åˆ Angular çš„ Commit message æ ¼å¼çš„æäº¤è§„èŒƒï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œåé¢ä¼šè®²åˆ°~ï¼‰ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆç¬¦åˆ Angular æäº¤è§„èŒƒæ ¼å¼çš„ Commit messageã€‚

å¦‚æœä½ é¡¹ç›®ç”¨çš„æ˜¯ npm ğŸ‘‡

```sh
# å¦‚æœä½ é¡¹ç›®ç”¨çš„æ˜¯npm
npx --no-install commitizen init cz-conventional-changelog --save-dev --save-exact
```

å¦‚æœä½ é¡¹ç›®ç”¨çš„æ˜¯ yarn ğŸ‘‡

```sh
# å¦‚æœä½ é¡¹ç›®ç”¨çš„æ˜¯yarn
npx --no-install commitizen init cz-conventional-changelog --save-dev --save-exact
```

è¿è¡Œäº†ä¸Šè¿°å‘½ä»¤åï¼Œå®ƒå°†ä¸ºä½ é¡¹ç›®å®‰è£… cz-conventional-changelog é€‚é…å™¨æ¨¡å—ï¼ŒæŠŠ config.commitizen çš„å¯†é’¥æ·»åŠ åˆ°æ–‡ä»¶çš„æ ¹ç›®å½•æ·»åŠ åˆ° `package.json` ä¸­

å¯ä»¥åœ¨`package.json` ä¸­çœ‹åˆ°ï¼Œè‡ªåŠ¨çš„æ–°å¢äº†ä»¥ä¸‹å†…å®¹ ğŸ‘‡

```json
{
  ...
  "config": {
    "commitizen": {
      "path": "./node_modules/cz-conventional-changelog"
    }
  }
  ...
}
```

å¦‚æœä¸æ˜¯å…¨å±€å®‰è£…çš„`commitizen`,åˆ™éœ€è¦åœ¨ package.json çš„ scripts ä¸­æ·»åŠ `cz:"cz"`å‘½ä»¤, ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿæ·»åŠ  ğŸ‘‡

```sh
npm set-script cz "cz"
```

å®Œæˆåï¼Œé€šè¿‡å‘½ä»¤`yarn cz`ï¼Œä½ å¦‚æœæ˜¯å…¨å±€å®‰è£…çš„ `commitizen`ï¼Œé‚£ä½ ç›´æ¥ `git cz`ï¼Œéƒ½å¯ä»¥é€šè¿‡ä»¥ä¸‹äº¤äº’å¼çš„æ’°å†™ commit messag ç„¶åæäº¤

![](https://assets.fedtop.com/picbed/202202130119061.gif)

## é™åˆ¶ commitlint

ç”±äº commitizen å¹¶ä¸æ˜¯å¼ºåˆ¶ä½¿ç”¨çš„ï¼Œä»ç„¶å¯ä»¥é€šè¿‡`git commit`æ¥æäº¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åœ¨ä¸ç®¡æ˜¯é€šè¿‡`cz`è¿˜æ˜¯`git commit`æäº¤å‰ï¼Œéƒ½è¦å¯¹ commit messag è¿›è¡Œä¸€æ¬¡æ ¡éªŒï¼Œä¸ç¬¦åˆè§„èŒƒçš„æƒ…å†µä¸‹æ˜¯ä¸å…è®¸è¿›è¡Œ commit çš„

é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…`commitlint`,`commitlint/config-conventional`

```sh
yarn add @commitlint/cli @commitlint/config-conventional -D
```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º git hooks çš„ commit-msg é’©å­ ğŸ‘‡ è¿™æ ·æ¯æ¬¡ commit çš„æ—¶å€™éƒ½ä¼šç”± commitlint å¯¹ commit message è¿›è¡Œä¸€æ¬¡æ£€éªŒ

```sh
npx --no-instal husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
```

ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª commitlint é…ç½®æ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½• ğŸ‘‡

```sh
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
```

ä»¥ä¸Šå°†ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸­ç”Ÿæˆ `commitlint.config.js`ï¼Œä»£ç å¦‚ä¸‹ï¼Œä»–å°†ç»§æ‰¿`@commitlint/config-conventional`ä¸­çš„ Commit message è§„èŒƒã€‚ï¼ˆ"feat", "fix", "perf", "refactor"...ï¼‰

```javascript
module.exports = {
  extends: ['@commitlint/config-conventional'],
}
```

ç„¶åæˆ‘ä»¬åœ¨ç»ˆç«¯è¿›è¡Œæµ‹è¯•

```sh
echo 'feat: bar' | npx --no-install commitlint
```

å¦‚æœä½ æ‰§è¡Œä¸Šé¢è¿™ä¸ªè¡Œå‘½ä»¤åå‡ºç°äº†ä»¥ä¸Šè¿™ç§æŠ¥é”™ã€‚

![](https://assets.fedtop.com/picbed/202202120201914.png)

å°†æ–‡ä»¶æ›´æ”¹é—® UTF-8 çš„æ ¼å¼å³å¯è§£å†³ï¼›è¿™ä¸ªé—®é¢˜ç›®å‰å·²ç»åœ¨ ğŸ‘‰ [Issues](https://github.com/conventional-changelog/commitlint/issues/270)ä¸­ï¼Œæœ‰ä¸å°‘äººé‡åˆ°äº†ï¼ˆæˆ‘ä¹Ÿæ˜¯ ğŸ˜‚ï¼‰ã€‚  
æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ï¼ŒæŠŠæ–‡ä»¶ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œé€‰æ‹©å¦å­˜ä¸ºï¼Œç„¶ååœ¨å¼¹çª—çš„å³ä¸‹è§’æ›´æ”¹å­—ç¬¦ç¼–ç ä¸º UTF-8 ï¼ˆWindows ç”¨æˆ·è¿è¡Œ`echo "xxx" > xx.js`æ—¶ï¼Œæ–‡ä»¶ç¼–ç å¯èƒ½ä¸º UTF-16 LEï¼‰ï¼Œæ›´æ”¹å¥½åï¼ŒæŠŠåŸæ¥çš„`commitlint.config.js`æ–‡ä»¶æ›¿æ¢æ‰å³å¯ã€‚

è§£å†³ä»¥ä¸Šé—®é¢˜åï¼Œæˆ‘ä»¬å†æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸ç¬¦åˆè§„èŒƒçš„ commit-msg æ˜¯ä¼šå¯¼è‡´æŠ¥é”™çš„ï¼Œä¹Ÿå°± commit ä¸äº†äº†ï¼Œè¯´æ˜æˆ‘ä»¬çš„ commitlint å·²ç»ç”Ÿæ•ˆäº†~ ğŸ‘ğŸ‘ğŸ‘

![](https://assets.fedtop.com/picbed/20220511232050.png)

åˆ°æ­¤ï¼Œcommit-msg çš„æ ¡éªŒä¹Ÿå·²ç»å®Œæˆ âœ”

å¦‚æœï¼Œä½ æƒ³è‡ªå®šä¹‰ commitlint çš„äº¤äº’æ–‡æœ¬ï¼ˆä¸ç”¨ featï¼Œfix...ï¼Œå¾ˆå¤šäººéƒ½å–œæ¬¢åœ¨ commit message å‰é¢åŠ ä¸€ä¸ª emoji è¡¨æƒ…ç¬¦å·ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ã€‚

æˆ‘ä»¬éœ€è¦å®‰è£… `cz-customizable`æ¥å®ç°è‡ªå®šä¹‰ commit message è§„åˆ™ï¼Œä»¥åŠå®‰è£…å¯¹åº”çš„`commitlint-config-cz`æ¥é…å¥—æ ¡éªŒï¼ˆç›´æ¥ä»è‡ªå®šä¹‰çš„æ–‡ä»¶é‡Œè¯»å–è§„åˆ™ï¼‰

è¿è¡Œä»¥ä¸‹å‘½ä»¤ ğŸ‘‡

```sh
yarn add commitlint-config-cz  cz-customizable -D
```

åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª`.cz-config.js`æ–‡ä»¶ï¼Œå¹¶å¤åˆ¶[cz-config-EXAMPLE.js ](https://github.com/leoforfree/cz-customizable/blob/master/cz-config-EXAMPLE.js)ä¸­çš„å†…å®¹åˆ°å…¶ä¸­ã€‚ç„¶åæ”¹æˆä½ è‡ªå·±æƒ³è¦çš„è§„åˆ™å³å¯ã€‚

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨æˆ‘å†™å¥½çš„ï¼š

```javascript
module.exports = {
  types: [
    { value: 'feat', name: 'feat: ä¸€ä¸ªæ–°çš„ç‰¹æ€§' },
    { value: 'fix', name: 'fix: ä¿®å¤ä¸€ä¸ªBug' },
    { value: 'docs', name: 'docs: å˜æ›´çš„åªæœ‰æ–‡æ¡£' },
    { value: 'style', name: 'style: ä»£ç é£æ ¼,æ ¼å¼ä¿®å¤' },
    { value: 'refactor', name: 'refactor: ä»£ç é‡æ„ï¼Œæ³¨æ„å’Œfeatã€fixåŒºåˆ†å¼€' },
    { value: 'perf', name: 'perf: ç ä¼˜åŒ–,æ”¹å–„æ€§èƒ½' },
    { value: 'test', name: 'test: æµ‹è¯•' },
    { alue: 'chore', name: 'chore: å˜æ›´æ„å»ºæµç¨‹æˆ–è¾…åŠ©å·¥å…·' },
    { value: 'revert', name: 'revert: ä»£ç å›é€€' },
    { value: 'init', name: 'init: é¡¹ç›®åˆå§‹åŒ–' },
    { value: 'build', name: 'build: å˜æ›´é¡¹ç›®æ„å»ºæˆ–å¤–éƒ¨ä¾èµ–' },
    { value: 'WIP', name: 'WIP: è¿›è¡Œä¸­çš„å·¥ä½œ' },
  ],
  scopes: [],
  allowTicketNumber: false,
  isTicketNumberRequired: false,
  ticketNumberPrefix: 'TICKET-',
  ticketNumberRegExp: '\\d{1,5}',
  // it needs to match the value for field type. Eg.: 'fix'
  /*
  scopeOverrides: {
    fix: [
      {name: 'merge'},
      {name: 'style'},
      {name: 'e2eTest'},
      {name: 'unitTest'}
    ]
  },
  */
  // override the messages, defaults are as follows
  messages: {
    type: 'é€‰æ‹©ä¸€ç§ä½ çš„æäº¤ç±»å‹:',
    scope: 'é€‰æ‹©ä¸€ä¸ªscope (å¯é€‰):',
    // used if allowCustomScopes is true
    customScope: 'Denote the SCOPE of this change:',
    subject: 'ç®€çŸ­è¯´æ˜(æœ€å¤š40ä¸ªå­—):',
    body: 'é•¿è¯´æ˜ï¼Œä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰)ï¼š\n',
    breaking: 'éå…¼å®¹æ€§è¯´æ˜ (å¯é€‰):\n',
    footer: 'å…³è”å…³é—­çš„issueï¼Œä¾‹å¦‚ï¼š#12, #34(å¯é€‰):\n',
    confirmCommit: 'ç¡®å®šæäº¤?',
  },
  allowCustomScopes: true,
  allowBreakingChanges: ['feat', 'fix'],
  // skip any questions you want
  skipQuestions: ['scope', 'body', 'breaking'],
  // limit subject length
  subjectLimit: 100,
  // breaklineChar: '|', // It is supported for fields body and footer.
  // footerPrefix : 'ISSUES CLOSED:'
  // askForBreakingChangeFirst : true, // default is false
}
```

åˆ›å»ºå®Œ`.cz-config.js`æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦å›åˆ° package.json æ–‡ä»¶ä¸­ï¼Œå°† config.commitizen.path æ›´æ”¹ä¸º`"node_modules/cz-customizable"`,å¦‚æœä½ çš„`.cz-config.js`æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥ä¸é…ç½®ä¸‹é¢è¿™æ¡ï¼Œcommitlint-config-cz ä¼šè‡ªåŠ¨åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¯»æ‰¾: `.cz-config.js`æˆ– `.config/cz-config.js`

```json
...
{
  "config": {
    "commitizen": {
      "path": "node_modules/cz-customizable"
    },
    // å¦‚æœä½ çš„.cz-config.jsæ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥ä¸é…ç½®ä¸‹é¢è¿™æ¡ï¼Œcommitlint-config-czä¼šè‡ªåŠ¨åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¯»æ‰¾: .cz-config.js æˆ– .config/cz-config.js
    "cz-customizable": {
      "config": "ä½ çš„æ–‡ä»¶è·¯å¾„/xxxconfig.js"
    }
  }
}
...
```

å…³äº`commitlint-config-cz`æ›´é«˜çº§çš„ç”¨æ³•å¯ä»¥æŸ¥çœ‹ ğŸ‘‰[commitlint-config-cz](https://github.com/whizark/commitlint-config-cz)

æœ€åæˆ‘ä»¬å°†ä¹‹å‰åˆ›å»ºè¿‡çš„`commitlint.config.js`ä¸­çš„ä»£ç è¿›è¡Œæ›´æ”¹ ğŸ‘‡

```diff
module.exports = {
- extends: ["@commitlint/config-conventional"],
+ extends: ["cz"],
};
```

æˆ–è€…ä½ ä¹Ÿå¯ä»¥åœ¨`commitlint.config.js`ä¸­æ‰‹åŠ¨æ·»åŠ è‡ªå®šä¹‰çš„è§„åˆ™ ğŸ‘‡,ä»–å°†è¦†ç›– extends ä¸­çš„è§„åˆ™

```javascript
module.exports = {
  extends: ["@commitlint/config-conventional"ï¼Œ"cz"],
  rules: {
    "type-enum": [
      2,
      "always",
      [
        "init",
        "build",
        "ci",
        "chore",
        "docs",
        "feat",
        "fix",
        "perf",
        "refactor",
        "revert",
        "style",
        "test",
      ],
    ],
  },
};
```

åˆ°è¿™é‡Œï¼Œè‡ªå®šä¹‰çš„ commit message çš„æ ¡éªŒä¹Ÿ ok äº† âœ…

![](https://assets.fedtop.com/picbed/202202130341135.gif)

## æœ€å

æé†’ï¼šé¡¹ç›®çš„ä»£ç é£æ ¼å’Œè§„åˆ™è¦å’Œå›¢é˜Ÿä¸€èµ·åˆ¶å®šå“¦ ~  
è‡³æ­¤ï¼Œåœ¨å›¢é˜ŸååŒçš„é¡¹ç›®ä¸­ï¼Œä¸ç¬¦åˆè§„èŒƒçš„æäº¤å°±è¢«æ‰¼æ€åœ¨æ‘‡ç¯®é‡Œé¢äº†ã€‚æˆ‘ä»¬å¤§å®¶ä¸ç®¡æ˜¯ä»ä¹¦å†™ä»£ç è¿˜æ˜¯æäº¤ä»£ç æœ€å¥½éƒ½è¦è§„èŒƒå“¦~ä¸ç»™è‡ªå·±æƒ¹éº»çƒ¦çš„åŒæ—¶ï¼Œä¹Ÿä¸ä¼šç»™ä»–äººæˆ–å…¬å¸å¸¦æ¥éº»çƒ¦ã€‚è¿™å°±æ˜¯æœ¬ç¯‡çš„å…¨éƒ¨å†…å®¹å•¦~å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµé¼“åŠ± ~  
æˆ‘æ˜¯è£é¡¶ï¼Œä¸€ä¸ªé¢å‘å¿«ä¹ç¼–ç¨‹çš„å‰ç«¯å¼€å‘ ğŸ¥° æˆ‘ä»¬ä¸‹æ¬¡å†è§ ~
