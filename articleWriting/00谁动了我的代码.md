# è°åŠ¨äº†æˆ‘çš„ä»£ç !

ä¸‹é¢æˆ‘å°†å¸¦å¤§å®¶ä¸€èµ·ï¼Œå®Œæˆä¸€ä¸ªä»£ç è§„èŒƒæ ¡éªŒ

æ²¡åŠæ³•ï¼Œå¥³å­©å­å˜›ã€‚ã€‚ã€‚ä¹Ÿä¸å¥½è¯´ä»€ä¹ˆã€‚  
è¦æ˜¯ç”·ç”Ÿï¼Œæˆ‘ä¸€å®šç«™èµ·æ¥å¤§éª‚ï¼Œä½ çœŸæ˜¯ä¸€ä¸ª **å°(x)å¯(x)çˆ±(x)**ï¼

## husky

æå·¥ç¨‹åŒ–ï¼Œæˆ‘ä»¬è‚¯å®šéƒ½å°‘ä¸äº† `husky`ï¼Œå®ƒèƒ½å¾ˆæ–¹ä¾¿çš„å¸®æˆ‘ä»¬é˜»æŒ¡å°å¯çˆ±çš„è¿›æ”»ï¼Œä¸ï¼Œæ˜¯ä¸ºå¾®æˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ `git hooks`

### å…·ä½“æ–¹æ³•

é¦–å…ˆæˆ‘ä»¬å°† `husky` å®‰è£…åˆ°å¼€å‘ä¾èµ–ä¸­

```sh
npm i husky -D
# or
yarn add husky -D
```

> ### æ³¨æ„
>
> ç›®å‰æˆ‘æ‰€å®‰è£…çš„ç‰ˆæœ¬æ˜¯`husky@7.0.4`,ç”±äº`husky@6.0.0` ååšäº†`breaking change`ï¼Œæ‰€ä»¥åœ¨`6.0.0`ç‰ˆæœ¬ä¹‹å‰çš„é‚£ç§è®¾ç½®é’©å­çš„æ–¹æ³•å·²ç»ä¸é€‚ç”¨äº†,**è¿™é‡Œæˆ‘ä»¬åªä»‹ç»æœ€æ–°çš„æ–¹å¼**ã€‚

å®‰è£…å®Œåï¼Œæˆ‘ä»¬éœ€è¦åœ¨å½“å‰é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª`.husky`ç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º `git hooks` æ‰€åœ¨çš„ç›®å½•ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º ğŸ‘‡

```sh
#--no-install å‚æ•°è¡¨ç¤ºå¼ºåˆ¶npxä½¿ç”¨é¡¹ç›®ä¸­node_modulesç›®å½•ä¸‹çš„huskyä¾èµ–åŒ…
npx --no-install husky install
```

ä¸ºäº†è®©å…¶ä»–äººåœ¨æ­¤é¡¹ç›®ä¸­å®‰è£…ä¾èµ–åä¹Ÿèƒ½è‡ªåŠ¨åˆ›å»º`.husky`ç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º `git hooks` æ‰€åœ¨çš„ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `package.json` é‡Œé¢æ·»åŠ ä¸€æ¡è„šæœ¬`"prepare": "husky install"`

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿæ·»åŠ  ğŸ‘‡

```sh
npm set-script prepare "husky install"
```

> `prepare` è„šæœ¬ä¼šåœ¨ `npm i`æˆ–è€…å…¶ä»–`yarn or yarn add` ä¹‹åè‡ªåŠ¨æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬å®‰è£…ä¾èµ–åä¼šè‡ªåŠ¨æ‰§è¡Œ `husky install` å‘½ä»¤ï¼Œä»è€Œè‡ªåŠ¨åˆ›å»º`.husky`ç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º `git hooks` æ‰€åœ¨çš„ç›®å½•ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º ğŸ‘‡

```sh
npx husky add .husky/pre-commit "npm run [ä½ è¦æ‰§è¡Œçš„å‘½ä»¤]"
```

å®Œæˆåå¯ä»¥çœ‹åˆ°`.husky`ç›®å½•ä¸‹æ–°å¢äº†ä¸€ä¸ª`pre-commit`æ–‡ä»¶,å…¶ä¸­çš„å†…å®¹ä¸º ğŸ‘‡
![](https://gitee.com/wangrongding/image-house/raw/master/images/202202102247151.png)

è¿™é‡Œæˆ‘ç”¨çš„æ˜¯`npm run lint`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é…åˆ Eslint çš„ä»£ç æ ¡éªŒ,æ¥é™åˆ¶ä¸è§„èŒƒä»£ç çš„æäº¤äº†

![](https://gitee.com/wangrongding/image-house/raw/master/images/202202102258141.png)  
å¯ä»¥çœ‹åˆ°ï¼Œä¸ç¬¦åˆ Eslint æ ¡éªŒè§„åˆ™çš„ä»£ç æ˜¯æ²¡æ³•æäº¤çš„ï¼›

å½“ç„¶ï¼Œè¿™é‡Œçš„æŠ¥é”™é—®é¢˜åªæ˜¯ç”±äºç¼©è¿›ä¸è§„èŒƒå¼•èµ·çš„ï¼Œç±»ä¼¼è¿™ç§çš„é—®é¢˜è¿˜æœ‰å¼•å·ï¼Œå¥å°¾åˆ†å·ï¼Œæ¢è¡Œç¬¦ç­‰ç­‰...éƒ½å¯ä»¥é€šè¿‡ `eslint` çš„å‚æ•° `--fix`æ¥è‡ªåŠ¨ä¿®å¤ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æäº¤å‰ï¼Œå…ˆå°†èƒ½å®ç°è‡ªåŠ¨ä¿®å¤çš„ç®€å•ä»£ç é£æ ¼é—®é¢˜å commitã€‚å¤æ‚çš„æƒ…å†µè¿˜æ˜¯è¦è‡ªå·±å»æ‰‹åŠ¨å¤„ç†çš„ã€‚

> è¯´åˆ°æ¢è¡Œç¬¦ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯ï¼šåœ¨ Windows ä¸Šé»˜è®¤çš„æ˜¯å›è½¦æ¢è¡Œï¼ˆCarriage Return Line Feed, CRLFï¼‰ï¼Œç„¶è€Œï¼Œåœ¨ Linux/MacOS ä¸Šåˆ™æ˜¯æ¢è¡Œï¼ˆLine Feed, LFï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹å°†åŸå…ˆæ¢è¡Œç¬¦ä¸º`crlf`çš„æ–‡ä»¶æ ¼å¼åŒ–ä¸ºæ¢è¡Œç¬¦ä¸º`lf`ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ eslint çš„--fix ä¿®å¤ä¸º `lf`åï¼Œä¸”ä¸é€šè¿‡ `.gitattributes`æ–‡ä»¶è®¾ç½® eol(end of line)è€Œæ‰§è¡Œ`git add .`çš„æƒ…å†µã€‚

![](https://gitee.com/wangrongding/image-house/raw/master/images/202202110120354.png)

å¯ä»¥çœ‹åˆ°æœ€ç»ˆ LF æ¢è¡Œç¬¦è¿˜æ˜¯è¢« CRLF æ›¿æ¢äº†ï¼›

å»ºè®®å¤§å®¶åœ¨é¡¹ç›®ç›®å½•é‡Œæ–°å»ºä¸€ä¸ª`.gitattributes`ï¼ˆä¸»è¦ç”¨äºå®šä¹‰æ¯ç§æ–‡ä»¶çš„å±æ€§ï¼Œä»¥æ–¹ä¾¿ git å¸®æˆ‘ä»¬ç»Ÿä¸€ç®¡ç†ã€‚ï¼‰ï¼Œè®¾ç½® eol(end of line)ä¸ºæŒ‡å®šçš„æ¢è¡Œç¬¦ï¼ˆlf/crlfï¼‰ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ ğŸ‘‡

![](https://gitee.com/wangrongding/image-house/raw/master/images/202202110114810.png)

æ·»åŠ ä¸Šè¿°æ–‡ä»¶åï¼Œï¼Œåœ¨`git add`å,æ‰€æœ‰ä¸æ˜¯æŒ‡å®šæ¢è¡Œç¬¦çš„æ–‡ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨æ›´æ¢ä¸ºä½ æŒ‡å®šçš„æ¢è¡Œç¬¦ï¼Œä¾‹å¦‚æˆ‘è¿™é‡ŒæŒ‡å®šäº†`lf`,é‚£ä¹ˆ `git add .` åï¼Œä¸æ˜¯ä»¥ `lf` æ¢è¡Œçš„æ–‡ä»¶éƒ½ä¼šè¢«æˆåŠŸè‡ªåŠ¨ä¿®å¤ä¸º `lf` æ¢è¡Œï¼Œå¹¶åœ¨ç»ˆç«¯è¾“å‡º`warning: CRLF will be replaced by LF in xxxx/filename`ï¼Œå¦‚å›¾ ğŸ‘‡

![](https://gitee.com/wangrongding/image-house/raw/master/images/202202110149455.png)

`.gitattributes`æœ‰å¾ˆå¤šç”¨å¤„ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ ğŸ‘‰[gitattributes](https://git-scm.com/docs/gitattributes)

ğŸ¥° åˆ°è¿™é‡Œï¼Œä¸€ä¸ªæœ€ç®€å•çš„ä»£ç é£æ ¼é™åˆ¶æ–¹æ³•å°±å·²ç»å®ç°äº†ã€‚

æ—¢ç„¶åšäº†ï¼Œå°±è‚¯å®šè¦åšä¸€å¥—å®Œæ•´çš„ï¼Œä¸”å¥½ç”¨çš„ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç»§ç»­å®Œå–„å…¶ä»–åŠŸèƒ½ ~

---

## lint-staged

ä»€ä¹ˆæ˜¯`lint-staged`?é¡¾åæ€ä¹‰ï¼Œå€ŸåŠ©è¿™ä¸ªå·¥å…·åªæ˜¯ç”¨æ¥æ£€æŸ¥ git æš‚å­˜åŒºæ–‡ä»¶çš„ï¼Œå°±æ˜¯åœ¨ä½ `git add file1ï¼Œ2ï¼Œ3...` åçš„æš‚å­˜åŒºæ–‡ä»¶ä¸­è¿è¡Œ `lint` çš„ä¸€ä¸ªå·¥å…·ã€‚

æ¯•ç«Ÿï¼Œæ¯æ¬¡æäº¤ä¸€ä¸¤ä¸ªæ–‡ä»¶ï¼Œå´éƒ½è¦ `lint` æ‰€æœ‰æ–‡ä»¶è¯ï¼Œæ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œæˆ‘ä»¬åªå¯¹éœ€è¦æäº¤çš„ä»£ç è¿›è¡Œ `lint`,è¿™æ ·å¯ä»¥å‡å°‘æ²¡å¿…è¦çš„æ—¶é—´å¼€é”€ã€‚ï¼ˆå¦‚æœä½ æ¯æ¬¡ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œéƒ½è¦å» `lint` æ‰€æœ‰æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·å¯¹ä½ æ¥è¯´å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº† ğŸ¤ï¼‰

### ä½¿ç”¨æ–¹æ³•

æˆ‘ä»¬å°†`.husky/pre-commit`ä¸­ä¹‹å‰å†™ä»£ç æ”¹ä¸º ğŸ‘‡

```diff
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"
- npm run lint
+ npx --no-install lint-staged
```

ç„¶ååœ¨ package.json ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ,`lint-staged`å¯¹è±¡ä¸­é‡‡ç”¨é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œé”®åæ˜¯ä½ æƒ³å¤„ç†çš„å•ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªæ–‡ä»¶ç±»å‹ï¼Œé”®å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­ä¸º lint æ—¶æ‰§è¡Œçš„å‘½ä»¤ç»„ã€‚

```json
{
  "lint-staged": {
    "*.{ts,js,vue}": ["eslint"]
  }
}
```

æ·»åŠ ç©ä¸Šè¿°ä»£ç åï¼Œæˆ‘ä»¬é€šè¿‡æµ‹è¯•ï¼Œå°†ä¸¤ä¸ªæ–‡ä»¶çš„ç¼©è¿›æ”¹ä¸ºä¸ç¬¦åˆè§„èŒƒçš„æƒ…å†µï¼Œç„¶åå°†å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶æš‚å­˜åï¼Œæˆ‘ä»¬è¿è¡Œ`git commit`åå‘ç°ç»ˆç«¯çš„æŠ¥é”™ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶çš„ `lint` æŠ¥é”™ä¿¡æ¯,å¦ä¸€ä¸ªæ–‡ä»¶çš„æŠ¥é”™å¹¶æ²¡æœ‰å‡ºç°ã€‚

![](https://gitee.com/wangrongding/image-house/raw/master/images/202202110219538.png)

## é™åˆ¶ commit-msg

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º ğŸ‘‡

```sh
npx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
```
