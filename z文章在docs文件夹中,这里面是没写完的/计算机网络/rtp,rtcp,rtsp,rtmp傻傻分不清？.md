# RTP,RTCP,RTSP,RTMP,傻傻分不清？

## RTP

RTP(Real-time Transport Protocol)是用于 Internet 上针对多媒体数据流的一种传输协议。RTP 由两个紧密链接部分组成:RTP----传送具有实时属性的数据；RTP 控制协议（RTCP）----监控服务质量并传送正在进行的会话参与者的相关信息。

RTP 协议是建立在 UDP 协议上的。RTP 协议详细说明了在互联网上传递音频和视频的标准数据包格式。RTP 协议常用于流媒体系统（配合 RTCP 协议）、视频会议和视频电话系统（配合 H.263 或 SIP）。

RTP 本身并没有提供按时发送机制或其他服务质量（QoS）保证，它依赖于底层服务去实现这一过程。RTP 并不保证传送或防止无序传送，也不确定底层网络的可靠性。RTP 实行有序传送，RTP 中的序列号允许接收方重组发送方的包序列，同时序列号也能用于决定适当的包位置，例如：在视频解码中，就不需要顺序解码。

## RTCP

实时传输控制协议（Real-time Transport Control Protocol,RTCP）是实时传输协议（RTP）的一个姐妹协议。RTCP 为 RTP 媒体流提供信道外控制。RTCP 定期在流多媒体会话参加者之间传输控制数据。RTCP 的主要功能是为 RTP 所提供的服务质量提供反馈。RTCP 收集相关媒体连接的统计信息，例如：传输字节数，传输分组数，丢失分组数，时延抖动，单向和双向网络延迟等等。网络应用程序可以利用 RTCP 所提供的信息试图提高服务质量，比如限制信息流量或改用压缩比较小的编解码器。RTCP 本身不提供数据加密或身份认证，其伴生协议 SRTCP（安全实时传输控制协议）则可用于此类用途。

## RTSP

RTSP 协议定义了一对多应用程序如何有效通过 IP 网络传送多媒体数据。RTSP 在体系结构上位于 RTP 和 RTCP 之上，它使用 TCP 或 RTP 完成数据传输。HTTP 与 RTSP 相比，HTTP 传送 HTML，而 RTP 传送的是多媒体数据。HTTP 请求由客户机发出，服务器做出响应；RTSP 可以是双向的，即客户机和服务器都可以发出请求。

RTSP 与 RTP 最大的区别在于：RTSP 是一种双向实时数据传输协议，它允许客户端向服务器端发送请求，如回放、快进、倒退等操作。当然 RTSP 可基于 RTP 来传送数据，还可以选择 TCP、UDP、组播 UDP 等通道来发送数据，具有很好的扩展性。它是一种类似于 HTTP 协议的网络应用协议。

## RTMP

RTMP（Real Time Messaging Protocol）是 Adobe Systems 公司为 Flash 播放器和服务器之间音频、视频和数据传输开发的开放协议。它有三种变种：

（1）工作在 TCP 之上的明文协议，使用端口 1935；

（2）RTMPT 封装在 HTTP 请求之中，可穿越防火墙；

（3）RTMPS 类似 RTMPT，但使用的是 HTTPS 连接。

RTMP 视频播放的特点：

（1）RTMP 协议是采用实时的流式传输，所以不会缓存文件到客户端，这种特性说明用户想下载 RTMP 协议下的视频是比较难的；

（2）视频流可以随便拖动，既可以从任意时间点向服务器发送请求进行播放，并不需要视频有关键帧。相比而言，HTTP 协议下视频需要有关键帧才可以随意拖动。

（3）RTMP 协议支持点播/回放（通俗点将就是支持把 flv,f4v,mp4 文件放在 RTMP 服务器，客户端可以直接播放），直播（边录制视频边播放）。

RTMP 环境的架设：

因为该协议是 adobe 公司开发的，所以最初服务器端架设的环境是 FMS(Flash Media Server)，该软件为收费软件，价格昂贵。后来，开源软件 red5 的推出，使 rtmp 协议的架设成本大大缩小，但是在性能方面不如 fms 的稳定。此外，wowza 虽然是收费的，但价格比较适中。

## HLS

HTTP Live Streaming（HLS）是苹果公司(Apple Inc.)实现的基于 HTTP 的流媒体传输协议，可实现流媒体的直播和点播，主要应用在 iOS 系统，为 iOS 设备（如 iPhone、iPad）提供音视频直播和点播方案。HLS 点播，基本上就是常见的分段 HTTP 点播，不同在于，它的分段非常小。

相对于常见的流媒体直播协议，例如 RTMP 协议、RTSP 协议、MMS 协议等，HLS 直播最大的不同在于，「直播客户端获取到的，并不是一个完整的数据流。HLS 协议在服务器端将直播数据流存储为连续的、很短时长的媒体文件（MPEG-TS 格式），而客户端则不断的下载并播放这些小文件，因为服务器端总是会将最新的直播数据生成新的小文件，这样客户端只要不停的按顺序播放从服务器获取到的文件，就实现了直播。」由此可见，基本上可以认为，HLS 是以点播的技术方式来实现直播。由于数据通过 HTTP 协议传输，所以完全不用考虑防火墙或者代理的问题，而且分段文件的时长很短，客户端可以很快的选择和切换码率，以适应不同带宽条件下的播放。不过 HLS 的这种技术特点，决定了它的延迟一般总是会高于普通的流媒体直播协议。

HLS 提供一个 m3u8 地址，Apple 的 Safari 浏览器直接就能打开 m3u8 地址，譬如香港卫视:http://live.hkstv.hk.lxdns.com/live/hks/playlist.m3u8

## 总结

### RTP RTCP RTSP 区别与联系

- RTP 传输流媒体数据、RTCP 对 RTP 进行控制，同步、RTSP 发起/终止流媒体
- RTP 和 RTCP 互为姐妹关系，RTSP 可以使用 RTP 来传输数据，但并没有绑定关系也可以使用 TCP/UDP
- RTSP、RTMP、HLS 都可以做直播和点播，它们是三种不同的应用层协议

### RTSP、RTMP、HLS 区别与联系

RTSP、RTMP、HLS 都可以做直播和点播，它们是三种不同的应用层协议

- HLS 延迟大，适合视频点播
- RTSP 实时性最好，但是实现复杂，适合视频聊天和视频监控
- RTMP 强在浏览器支持好，加载 flash 插件后就能直接播放，非常火，相反在浏览器里播放 rtsp 就很困难了

### 关于直播

直播应用中，RTMP 和 HLS 基本上可以覆盖所有客户端观看。

- RTSP 优势主要在于传输层可以使用 udp/rtp，实时性好，延迟可控制到 1s 内，
- RTMP 主要优势在于延时相对较低(1-3s)，而且 RTMP 支持的很完善，能做到 flash 播放 RTMP 流长时间不断流，以前很多 SIP 的视频会议已被 RTMP 所取代。
- HLS 的优势就是直接使用 http 协议请求流数据，可以在不同速率的版本间自由切换，实现无缝播放，缺点是延时比较大(10s 以上)。

三种协议各有各的优势，主要还是看场景选择，当然大点公司，可以做些私有协议来提供更好更符合场景的服务。

## 参考

- https://www.cnblogs.com/ailumiyana/p/12439010.html#hls
   