---
title: æˆ‘ç”¨ 10000 å¼ å›¾ç‰‡åˆæˆæˆ‘ä»¬ç¾å¥½çš„ç¬é—´
date: 2021-08-15
tags:
    - canvas
categories:
    - frontEnd
---


# æˆ‘ç”¨ 10000 å¼ å›¾ç‰‡åˆæˆæˆ‘ä»¬ç¾å¥½çš„ç¬é—´

>æœˆäº®ç…§å›æ¹–å¿ƒ é‡é¹¤å¥”å‘é—²äº‘

## å‰è¨€
æ˜¨å¤©æ˜¯æƒ…äººèŠ‚,å¤§å®¶æƒ³å¿…éƒ½éå¸¸æ„‰å¿«çš„åº¦è¿‡äº†èŠ‚æ—¥~æˆ‘ä¹Ÿæ˜¯ğŸ˜š  
å¥½äº†,åºŸè¯ä¸å¤šè¯´,ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é¡¹ç›®,é€šè¿‡åˆ‡å‰²ç›®æ ‡å›¾ç‰‡,è·å¾—10000ä¸ªæ–¹å—,ç”¨æˆ‘ä»¬æ‰€é€‰æ‹©åˆ°çš„å›¾ç‰‡,å¯¹åº”çš„å¡«å……æ–¹å—å®ç°ä¸€ä¸ªåƒå›¾æˆåƒçš„æ•ˆæœ.ä½ å¯ä»¥ç”¨å®ƒæ¥æ‹¼ä»»ä½•ä½ æƒ³æ‹¼çš„æœ‰æ„ä¹‰çš„å¤§å›¾.(æ¯”å¦‚æˆ‘,å°±æƒ³ç”¨å®ƒæŠŠæˆ‘å’Œå¯¹è±¡æ‹çˆ±åˆ°ç»“å©šæ‹çš„æ‰€æœ‰ç…§ç‰‡ç”¨æ¥åšä¸€ä¸ªè¶…çº§è¶…çº§è¶…çº§è¶…çº§å¤§çš„å©šçº±ç…§,åœ¨è€å®¶[é„±é˜³æ¹–]è‰åœ°ä¸Šé“ºç€,ç”¨æ— äººæœºé«˜ç©ºä¿¯ç°,åœ¨è¿™é‡Œå…ˆåŸ‹ä¸ªç‚¹,å¸Œæœ›å‡ å¹´åèƒ½å¤Ÿå®ç°ğŸ˜Š)  

é¦–å…ˆ,è¿™ç¯‡æ–‡ç« æ˜¯åŸºäºæˆ‘çš„ä¸Šä¸€ç¯‡fabricå…¥é—¨ç¯‡æ‰€å‡ºçš„ä¸€ç¯‡å®ç”¨æ¡ˆä¾‹,ä¹Ÿæ˜¯æˆ‘è‡ªå·±ç”¨æ¥ç»ƒæ‰‹æ€»ç»“æ‰€ç”¨,åœ¨æ­¤åˆ†äº«ç»™å¤§å®¶,ä¸€èµ·æˆé•¿!  


## è¿›å…¥æ­£é¢˜

### é¦–å…ˆæˆ‘ä»¬åˆå§‹ä¸€ä¸ª 800\*800 çš„ç”»å¸ƒ

**(ç•Œé¢çš„æ ·å¼,åœ¨è¿™é‡Œæˆ‘å°±ä¸è¿‡å¤šè¡¨è¿°äº†,æˆ‘ä»¬ä¸»è¦è®²é€»è¾‘åŠŸèƒ½çš„å®ç°)**

```JavaScript
//åˆå§‹åŒ–ç”»å¸ƒ
initCanvas() {
    this.canvas = new fabric.Canvas("canvas", {
        selectable: false,
        selection: false,
        hoverCursor: "pointer",
    });
    this.ctx = canvas.getContext("2d");
    this.addCanvasEvent();//ç»™ç”»å¸ƒæ·»åŠ äº‹ä»¶
},
```

æ ¹æ®è‡ªå·±ç”µè„‘çš„é…ç½®æ¥è‡ªå®šä¹‰ç”»å¸ƒçš„å¤§å°, ç›®å‰è¿˜æ²¡æ‰¾åˆ°ç›´æ¥åœ¨ web ç«¯åšç±»ä¼¼åƒå›¾æˆåƒçš„,åœ¨ web ç«¯å®ç°è¿™ä¸ªåŠŸèƒ½ç¡®å®æ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½çš„,å› ä¸ºéœ€è¦å¤„ç†çš„æ•°æ®é‡å¥½å¤§,è®¡ç®—é‡ä¹Ÿå¤§  
**éœ€è¦æ³¨æ„çš„æ˜¯: 800\*800 çš„ç”»å¸ƒæœ‰ 640000 ä¸ªåƒç´ ,é€šè¿‡`ctx.getImageData`è·å–åˆ°çš„æ¯ä¸ªåƒç´ æ˜¯ 4 ä¸ªå€¼,å°±æ˜¯ 2560000 ä¸ªå€¼,æˆ‘ä»¬åé¢éœ€è¦å¤„ç†è¿™ 2560000 ä¸ªå€¼,æ‰€ä»¥è¿™é‡Œæˆ‘å°±ä¸åšå¤§äº†**

![](https://files.mdnice.com/user/17056/a3dac293-4243-4db4-be4c-292d3c6daa03.png)

### ç”¨ fabric ç»˜åˆ¶ç›®æ ‡å›¾ç‰‡

**éœ€è¦æ³¨æ„çš„æ˜¯,æˆ‘ä»¬é€šè¿‡æœ¬åœ°å›¾ç‰‡ç»˜åˆ¶åˆ°ç”»å¸ƒ,éœ€è¦å°†æ‹¿åˆ°çš„ file æ–‡ä»¶é€šè¿‡`window.URL.createObjectURL(file)`å°†æ–‡ä»¶è½¬ä¸º blob ç±»å‹çš„ url**

åƒä½ å–œæ¬¢ç”¨ elementUI çš„ upload ç»„ä»¶,ä½ å°±è¿™ä¹ˆå†™

```JavaScript
//ç›®æ ‡å›¾ç‰‡é€‰æ‹©å›è°ƒ
slectFile(file, fileList) {
    let tempUrl = window.URL.createObjectURL(file.raw);
    this.drawImage(tempUrl);
},
```

è¿™é‡Œæˆ‘ä¸å–œæ¬¢å®ƒçš„ç»„ä»¶,å› ä¸ºåé¢é€‰æ‹©èµ„æºå›¾ç‰‡çš„æ—¶å€™,é€‰æ‹©æ•°åƒå¼ å›¾ç‰‡ä¼šæœ‰æ–‡ä»¶åˆ—è¡¨,æˆ‘åˆä¸æƒ³éšè—å®ƒ(ä¸»è¦è¿˜æ˜¯æƒ³åˆ†äº«ä¸€ä¸‹è‡ªå®šä¹‰çš„æ–‡ä»¶é€‰æ‹©)  
æ‰€ä»¥æˆ‘æ˜¯è¿™ä¹ˆå†™çš„

```JavaScript
export function inputFile() {
    return new Promise(function (resolve, reject) {
        if (document.getElementById("myInput")) {
            let inputFile = document.getElementById("myInput");
            inputFile.onchange = (e) => {
                let urlArr = [];
                for (let i = 0; i < e.target.files.length; i++) {
                    urlArr.push(URL.createObjectURL(e.target.files[i]));
                }
                resolve(urlArr);
            };
            inputFile.click();
        } else {
            let inputFile = document.createElement("input");
            inputFile.setAttribute("id", "myInput");
            inputFile.setAttribute("type", "file");
            inputFile.setAttribute("accept", "image/*");
            inputFile.setAttribute("name", "file");
            inputFile.setAttribute("multiple", "multiple");
            inputFile.setAttribute("style", "display: none");
            inputFile.onchange = (e) => {
                // console.log(e.target.files[0]);
                // console.log(e.target.files);
                // let tempUrl = URL.createObjectURL(e.target.files[0]);
                // console.log(tempUrl);
                let urlArr = [];
                for (let i = 0; i < e.target.files.length; i++) {
                    urlArr.push(URL.createObjectURL(e.target.files[i]));
                }
                resolve(urlArr);
            };
            document.body.appendChild(inputFile);
            inputFile.click();
        }
    });
}
```

é€šè¿‡ä»¥ä¸Šæ–¹æ³•æ‹¿åˆ°æ–‡ä»¶å,æˆ‘åœ¨é‡Œé¢å·²ç»å°†å›¾ç‰‡æ–‡ä»¶è½¬ä¸ºäº† blob çš„ URL ä¾›æˆ‘ä»¬ä½¿ç”¨ **(éœ€è¦æ³¨æ„çš„æ˜¯æ–‡ä»¶çš„é€‰æ‹©æ˜¯å¼‚æ­¥çš„,æ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨ promise æ¥å†™)**

```JavaScript
//ç»˜åˆ¶ç›®æ ‡å›¾ç‰‡
drawImage(url) {
    fabric.Image.fromURL(url, (img) => {
        //è®¾ç½®ç¼©æ”¾æ¯”ä¾‹,é•¿å›¾çš„ç¼©æ”¾æ¯”ä¸ºthis.canvas.width / img.width,å®½å›¾çš„ç¼©æ”¾æ¯”ä¸ºthis.canvas.height / img.height
        let scale =
            img.height > img.width
                ? this.canvas.width / img.width
                : this.canvas.height / img.height;
        img.set({
            left: this.canvas.height / 2, //è·ç¦»å·¦è¾¹çš„è·ç¦»
            originX: "center", //å›¾ç‰‡åœ¨åŸç‚¹çš„å¯¹é½æ–¹å¼
            top: 0,
            scaleX: scale, //æ¨ªå‘ç¼©æ”¾
            scaleY: scale, //çºµå‘ç¼©æ”¾
            selectable: false, //å¯äº¤äº’
        });
        //å›¾ç‰‡æ·»åŠ åˆ°ç”»å¸ƒçš„å›è°ƒå‡½æ•°
        img.on("added", (e) => {
            //è¿™é‡Œæœ‰ä¸ªé—®é¢˜,addedåè·å–çš„æ˜¯ä¹‹å‰çš„ç”»å¸ƒåƒç´ æ•°æ®,å…¶ä»–æ‰‹åŠ¨è§¦å‘çš„äº‹ä»¶,ä¸ä¼šæœ‰è¿™ç§é—®é¢˜
            //æ•…ç”¨ä¸€ä¸ªå¼‚æ­¥è§£å†³
            setTimeout(() => {
                this.getCanvasData();
            }, 500);
        });
        this.canvas.add(img); //å°†å›¾ç‰‡æ·»åŠ åˆ°ç”»å¸ƒ
        this.drawLine(); //ç»˜åˆ¶ç½‘æ ¼çº¿æ¡
    });
},
```

### ç»˜åˆ¶å®Œå›¾ç‰‡åé¡ºä¾¿åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶ 100\*100 çš„æ …æ ¼

```javaScript
//æ …æ ¼çº¿
drawLine() {
    const blockPixel = 8;
    for (let i = 0; i <= this.canvas.width / blockPixel; i++) {
        this.canvas.add(
            new fabric.Line([i * blockPixel, 0, i * blockPixel, this.canvas.height], {
                left: i * blockPixel,
                stroke: "gray",
                selectable: false, //æ˜¯å¦å¯è¢«é€‰ä¸­
            })
        );
        this.canvas.add(
            new fabric.Line([0, i * blockPixel, this.canvas.height, i * blockPixel], {
                top: i * blockPixel,
                stroke: "gray",
                selectable: false, //æ˜¯å¦å¯è¢«é€‰ä¸­
            })
        );
    }
},
```

**ç»˜åˆ¶å®Œæ¯•åå¯ä»¥çœ‹åˆ°å›¾ç‰‡åŠ ç½‘æ ¼çº¿çš„æ•ˆæœ,è¿˜æ˜¯æŒºå¥½çœ‹çš„~ğŸ˜˜**
![](https://files.mdnice.com/user/17056/640c97b2-91bb-4c32-b4e1-a7d79a47a4f7.png)

### å°†å›¾ç‰‡é¢œè‰²åˆ†å—ä¿å­˜åœ¨æ•°ç»„ä¸­

**ä¸€å¼€å§‹è¿™ä¹ˆå†™æŠŠæµè§ˆå™¨è·‘å´©äº†**

![](https://files.mdnice.com/user/17056/95f0b27c-ef2a-4ac9-82fd-df8ec48e50cb.png)

![](https://files.mdnice.com/user/17056/939d8f88-3526-4230-8a60-0c6ca2dcbee6.png)

---

**æˆ‘å“­ ğŸ˜¥,è¿™ä¹ˆå†™å¾ªç¯åµŒå¥—å¤ªå¤š(è€Œä¸”åŸºæ•°æ˜¯ 800\*800\*4==2560000-->å¾—å¥½å¥½å†™,è¦ä¸ç„¶å¯¹ä¸èµ· pixelList è¢«æˆ‘ç–¯ç‹‚æ“ä½œäº† 2560000 æ¬¡)å¾—ä¼˜åŒ–ä¸€ä¸‹å†™æ³•,æ—¢ç„¶æµè§ˆå™¨ç‚¸äº†,ç¬¨æ–¹æ³•è¡Œä¸é€š,é‚£åªèƒ½æ¢äº†~**

é¦–å…ˆè¯´æ˜,è¿™é‡Œæˆ‘ä»¬æ¯ä¸ªå°å—çš„é•¿å®½ç»™çš„æ˜¯ 8 ä¸ªåƒç´  **(è¶Šå°åé¢åˆæˆå›¾ç‰‡çš„ç²¾åº¦è¶Šç²¾ç»†,è¶Šå¤§è¶Šæ¨¡ç³Š)**

```JavaScript
//è·å–ç”»å¸ƒåƒç´ æ•°æ®
getCanvasData() {
    for (let Y = 0; Y < this.canvas.height / 8; Y++) {
        for (let X = 0; X < this.canvas.width / 8; X++) {
            //æ¯8*8åƒç´ çš„ä¸€å—åŒºåŸŸä¸€ç»„
            let tempColorData = this.ctx.getImageData(X * 8, Y * 8, 8, 8).data;
            //å°†è·å–åˆ°æ•°æ®æ¯4ä¸ªä¸€ç»„,æ¯ç»„éƒ½æ˜¯ä¸€ä¸ªåƒç´ 
            this.blockList[Y * 100 + X] = { position: [X, Y], color: [] };
            for (let i = 0; i < tempColorData.length; i += 4) {
                this.blockList[Y * 100 + X].color.push([
                    tempColorData[i],
                    tempColorData[i + 1],
                    tempColorData[i + 2],
                    tempColorData[i + 3],
                ]);
            }
        }
    }
    console.log(mostBlockColor(this.blockList));
    this.mostBlockColor(this.blockList);//è·å–æ¯ä¸ªå°å—çš„ä¸»è‰²è°ƒ
    this.loading = false;
},
```

![](https://files.mdnice.com/user/17056/c5be8677-2d4a-4cc6-81b1-eb318b6d56a7.png)

**ğŸ˜… æ¢äº†ä¸€ç§å†™æ³•å,è¿™é‡Œæˆ‘ä»¬å°†æ¯ä¸ª 8\*8 çš„åƒç´ å—åˆ’ä¸ºä¸€ç»„,å¾—åˆ° 10000 ä¸ªå…ƒç´ ,æ¯ä¸ªå…ƒç´ é‡Œéƒ½æœ‰ 4 ä¸ªå€¼,åˆ†åˆ«ä»£è¡¨ç€ RGBA çš„å€¼,åé¢æˆ‘ä»¬ä¼šç”¨å¯¹åº”çš„ 10000 å¼ å›¾ç‰‡å¡«å……å¯¹åº”çš„åƒç´ å—**
![](https://files.mdnice.com/user/17056/cb764b20-768f-4851-8d42-a7189b58c789.png)

<!-- ![](https://files.mdnice.com/user/17056/1032c219-882e-445b-ae20-cc200e238951.jpg) -->

**æ‹¿åˆ°ç”»å¸ƒä¸Šçš„æ‰€æœ‰åƒç´ å€¼å,æˆ‘ä»¬éœ€è¦æ±‚å‡ºæ¯ä¸ªå°æ–¹å—çš„ä¸»è‰²è°ƒ**  
åé¢æˆ‘ä»¬éœ€è¦é€šè¿‡è¿™äº›å°æ–¹å—çš„ä¸»è‰²è°ƒé€šè¿‡æ±‚å®ƒä¸èµ„æºå›¾ç‰‡çš„è‰²å·®,æ¥å†³å®šè¯¥æ–¹å—å…·ä½“æ˜¯å¡«å……å“ªä¸€å¼ å›¾ç‰‡ ğŸ˜Š  
åˆ°è¿™é‡Œå¾ˆå…´å¥‹,æ„Ÿè§‰æ˜¯å¿«å®Œæˆäº†ä¸€åŠäº†,å…¶å®ä¸ç„¶,åé¢æ›´æŠ“å¤´çš® ğŸ˜­

```JavaScript
 //è·å–æ¯ä¸ªæ ¼å­çš„ä¸»è‰²è°ƒ
mostBlockColor(blockList) {
    for (let i = 0; i < blockList.length; i++) {
        let colorList = [];
        let rgbaStr = "";
        for (let k = 0; k < blockList[k].color.length; k++) {
            rgbaStr = blockList[i].color[k];
            if (rgbaStr in colorList) {
                ++colorList[rgbaStr];
            } else {
                colorList[rgbaStr] = 1;
            }
        }
        let arr = [];
        for (let prop in colorList) {
            arr.push({
                // å¦‚æœåªè·å–rgb,åˆ™ä¸º`rgb(${prop})`
                color: prop.split(","),
                // color: `rgba(${prop})`,
                count: colorList[prop],
            });
        }
        // æ•°ç»„æ’åº
        arr.sort((a, b) => {
            return b.count - a.count;
        });
        arr[0].position = blockList[i].position;
        this.blockMainColors.push(arr[0]);
    }
    console.log(this.blockMainColors);
},
```

**è„‘ç“œå­ä¸å¥½ä½¿,è‰ç¨¿çº¸éƒ½ç”¨ä¸Šäº†**

### è·å–æ¯å¼ èµ„æºå›¾çš„ä¸»è‰²è°ƒ

```JavaScript
export function getMostColor(imgUrl) {
    return new Promise((resolve, reject) => {
        try {
            const canvas = document.createElement("canvas");
            //è®¾ç½®canvasçš„å®½é«˜éƒ½ä¸º20,è¶Šå°è¶Šå¿«,ä½†æ˜¯è¶Šå°è¶Šä¸ç²¾ç¡®
            canvas.width = 20;
            canvas.height = 20;
            const img = new Image(); // åˆ›å»ºimgå…ƒç´ 
            img.src = imgUrl; // è®¾ç½®å›¾ç‰‡æºåœ°å€
            img.onload = () => {
                const ctx = canvas.getContext("2d");
                const scaleH = canvas.height / img.height;
                img.height = canvas.height;
                img.width = img.width * scaleH;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                console.log(img.width, img.height);
                // è·å–åƒç´ æ•°æ®
                let pixelData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                let colorList = [];
                let color = [];
                let colorKey = "";
                let colorArr = [];
                // åˆ†ç»„å¾ªç¯
                for (let i = 0; i < pixelData.length; i += 4) {
                    color[0] = pixelData[i];
                    color[1] = pixelData[i + 1];
                    color[2] = pixelData[i + 2];
                    color[3] = pixelData[i + 3];
                    colorKey = color.join(",");
                    if (colorKey in colorList) {
                        ++colorList[colorKey];
                    } else {
                        colorList[colorKey] = 1;
                    }
                }
                for (let prop in colorList) {
                    colorArr.push({
                        color: prop.split(","),
                        count: colorList[prop],
                    });
                }
                // å¯¹æ‰€æœ‰é¢œè‰²æ•°ç»„æ’åº,å–ç¬¬ä¸€ä¸ªä¸ºä¸»è‰²è°ƒ
                colorArr.sort((a, b) => {
                    return b.count - a.count;
                });
                colorArr[0].url = imgUrl;
                console.log(
                    `%c rgba(${colorArr[0].color.join(",")})`,
                    `background: rgba(${colorArr[0].color.join(",")})`
                );
                resolve(colorArr[0]);
            };
        } catch (e) {
            reject(e);
        }
    });
}
```

**æˆ‘ä»¬éšæœºé€‰æ‹©ä¸€äº›æ–‡ä»¶å,å°†ä»–ä»¬çš„ä¸»è‰²è°ƒæ‰“å°å‡ºæ¥çœ‹çœ‹æ•ˆæœ**

![](https://files.mdnice.com/user/17056/88f5af9c-09bb-4c6e-9467-124cc64629c3.png)

### é¢œè‰²ç©ºé—´

è¦æ±‚é¢œè‰²çš„è‰²å·®,æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹é¢œè‰²çš„å®šä¹‰,é¢œè‰²æœ‰å¾ˆå¤šç§è¡¨ç¤ºæ–¹å¼,å®ƒä»¬çš„æ ‡å‡†éƒ½ä¸ç›¸åŒ,æœ‰ CMYK,RGB,HSB,LAB ç­‰ç­‰...  
**è¿™é‡Œæˆ‘ä»¬æ˜¯ RGBA çš„,å®ƒå°±æ˜¯ RGB çš„é¢œè‰²æ¨¡å‹é™„åŠ äº†é¢å¤–çš„ Alpha ä¿¡æ¯**

> RGBA æ˜¯ä»£è¡¨ Redï¼ˆçº¢è‰²ï¼‰Greenï¼ˆç»¿è‰²ï¼‰Blueï¼ˆè“è‰²ï¼‰å’Œ Alpha çš„è‰²å½©ç©ºé—´ã€‚è™½ç„¶å®ƒæœ‰çš„æ—¶å€™è¢«æè¿°ä¸ºä¸€ä¸ªé¢œè‰²ç©ºé—´ï¼Œä½†æ˜¯å®ƒå…¶å®ä»…ä»…æ˜¯ RGB æ¨¡å‹çš„é™„åŠ äº†é¢å¤–çš„ä¿¡æ¯ã€‚é‡‡ç”¨çš„é¢œè‰²æ˜¯ RGBï¼Œå¯ä»¥å±äºä»»ä½•ä¸€ç§ RGB é¢œè‰²ç©ºé—´ï¼Œä½†æ˜¯ Catmull å’Œ Smith åœ¨ 1971 è‡³ 1972 å¹´é—´æå‡ºäº†è¿™ä¸ªä¸å¯æˆ–ç¼ºçš„ alpha æ•°å€¼ï¼Œä½¿å¾— alpha æ¸²æŸ“å’Œ alpha åˆæˆå˜å¾—å¯èƒ½ã€‚æå‡ºè€…ä»¥ alpha æ¥å‘½åæ˜¯æºäºç»å…¸çš„çº¿æ€§æ’å€¼æ–¹ç¨‹ Î±A + (1-Î±)B æ‰€ç”¨çš„å°±æ˜¯è¿™ä¸ªå¸Œè…Šå­—æ¯ã€‚

![](https://files.mdnice.com/user/17056/be3cd2fc-1ff6-4d2b-bb70-936a05e8562b.png)
![](https://files.mdnice.com/user/17056/bf7626e0-19d3-4001-818f-6fb584c83e01.png)

å…¶ä»–é¢œè‰²çš„ç›¸å…³ä»‹ç»å¯ä»¥çœ‹  
[è¿™é‡Œ:](https://zhuanlan.zhihu.com/p/24281841)https://zhuanlan.zhihu.com/p/24281841  
æˆ–[è¿™é‡Œ](https://baike.baidu.com/item/%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4/10834848?fr=aladdin)https://baike.baidu.com/item/%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4/10834848?fr=aladdin

### æ±‚é¢œè‰²å·®å¼‚çš„æ–¹æ³•

**ç”±äºé¢œè‰²åœ¨ç©ºé—´ä¸­çš„åˆ†å¸ƒå¦‚ä¸Šé¢çš„ä»‹ç»æ‰€ç¤º,è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ä¸­å­¦å­¦è¿‡çš„æ¬§æ°è·ç¦»æ³•,æ¥æ±‚ä¸¤ä¸ªé¢œè‰²çš„ç»å¯¹è·ç¦»,é€šè¿‡å®ƒä»¬çš„è¿œè¿‘å°±çŸ¥é“ä¸¤ä¸ªé¢œè‰²çš„ç›¸ä¼¼ç¨‹åº¦çš„å¤§å°**

é¦–å…ˆæˆ‘ä»¬äº†è§£ä¸€ä¸‹æ¬§æ°è·ç¦»çš„åŸºæœ¬æ¦‚å¿µ

> æ¬§å‡ é‡Œå¾—åº¦é‡ï¼ˆeuclidean metricï¼‰ï¼ˆä¹Ÿç§°æ¬§æ°è·ç¦»ï¼‰æ˜¯ä¸€ä¸ªé€šå¸¸é‡‡ç”¨çš„è·ç¦»å®šä¹‰ï¼ŒæŒ‡åœ¨ m ç»´ç©ºé—´ä¸­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„çœŸå®è·ç¦»ï¼Œæˆ–è€…å‘é‡çš„è‡ªç„¶é•¿åº¦ï¼ˆå³è¯¥ ç‚¹åˆ°åŸç‚¹çš„è·ç¦»ï¼‰ã€‚åœ¨äºŒç»´å’Œä¸‰ç»´ç©ºé—´ä¸­çš„æ¬§æ°è·ç¦»å°±æ˜¯ä¸¤ç‚¹ä¹‹é—´çš„å®é™…è·ç¦»ã€‚

![](https://files.mdnice.com/user/17056/71777d40-b0cb-4ae4-bc68-fc1ddd9faf39.png)

**å°†å…¬å¼è½¬åŒ–ä¸ºä»£ç :**

```JavaScript
//è®¡ç®—é¢œè‰²å·®å¼‚
colorDiff(color1, color2) {
    let distance = 0;//åˆå§‹åŒ–è·ç¦»
    for (let i = 0; i < color1.length; i++) {
        distance += (color1[i] - color2[i]) ** 2;//å¯¹ä¸¤ç»„é¢œè‰²r,g,b[a]çš„å·®çš„å¹³æ–¹æ±‚å’Œ
    }
    return Math.sqrt(distance);//å¼€å¹³æ–¹åå¾—åˆ°ä¸¤ä¸ªé¢œè‰²åœ¨è‰²å½©ç©ºé—´çš„ç»å¯¹è·ç¦»
},
```

è®¡ç®—é¢œè‰²å·®å¼‚çš„æ–¹æ³•æœ‰å¤šç§,å¯ä»¥çœ‹[wikiwand:](https://www.wikiwand.com/en/Color_difference#/sRGB)https://www.wikiwand.com/en/Color_difference#/sRGB  
æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼ ColorRNA.js ç­‰é¢œè‰²å¤„ç†åº“è¿›è¡Œå¯¹æ¯”,è¿™é‡Œæˆ‘ä»¬ä¸åšè¿‡å¤šæè¿°

### è®¡ç®—å·®å€¼åæ¸²æŸ“å›¾ç‰‡

**åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªåƒç´ å—çš„ä¸»è‰²è°ƒä¸æ‰€æœ‰èµ„æºå›¾ç‰‡çš„ä¸»è‰²è°ƒä½œæ¯”è¾ƒ,å–å·®å¼‚æœ€å°çš„é‚£å¼ æ¸²æŸ“åˆ°å¯¹åº”çš„æ–¹å—ä¸Š**

![](https://files.mdnice.com/user/17056/50d6db64-da63-464b-8f08-cc17b0cc0357.png)

```JavaScript
//ç”Ÿæˆå›¾ç‰‡
generateImg() {
    this.loading = true;
    let diffColorList = [];
    //éå†æ‰€æœ‰æ–¹å—
    for (let i = 0; i < this.blockMainColors.length; i++) {
        diffColorList[i] = { diffs: [] };
        //éå†æ‰€æœ‰å›¾ç‰‡
        for (let j = 0; j < this.imgList.length; j++) {
            diffColorList[i].diffs.push({
                url: this.imgList[j].url,
                diff: this.colorDiff(this.blockMainColors[i].color, this.imgList[j].color),
                color: this.imgList[j].color,
            });
        }
        //å¯¹æ¯”è¾ƒè¿‡çš„å›¾ç‰‡è¿›è¡Œæ’åº,å·®å¼‚æœ€å°çš„æ”¾æœ€å‰é¢
        diffColorList[i].diffs.sort((a, b) => {
            return a.diff - b.diff;
        });
        //å–ç¬¬0ä¸ªå›¾ç‰‡ä¿¡æ¯
        diffColorList[i].url = diffColorList[i].diffs[0].url;
        diffColorList[i].position = this.blockMainColors[i].position;
        diffColorList[i].Acolor = this.blockMainColors[i].color;
        diffColorList[i].Bcolor = diffColorList[i].diffs[0].color;
    }
    this.loading = false;
    console.log(diffColorList);
    //ä¾¿åˆ©æ¯ä¸€ä¸ªæ–¹å—,å¯¹å…¶æ¸²æŸ“
    diffColorList.forEach((item) => {
        fabric.Image.fromURL(item.url, (img) => {
            let scale = img.height > img.width ? 8 / img.width : 8 / img.height;
            // img.scale(8 / img.height);
            img.set({
                left: item.position[0] * 8,
                top: item.position[1] * 8,
                originX: "center",
                scaleX: scale,
                scaleY: scale,
            });
            this.canvas.add(img);
        });
    });
},
```

**å¥½å®¶ä¼™!!! è¿™æ˜¯ä»€ä¹ˆç©æ„???è¿™æäº†ä¸€æ™šä¸Š,å‡ºä¸ªè¿™?**

**æˆ‘å“­äº†,ç°åœ¨éƒ½äº”ç‚¹å¤šäº†,æˆ‘è¿˜æ²¡ç¡å‘¢~**
![](https://files.mdnice.com/user/17056/9370e86e-6489-4779-9063-3d3f498babe1.png)

**ä¸æŠ›å¼ƒä¸æ”¾å¼ƒ,åšæŒåˆ°åº•å°±æ˜¯èƒœåˆ©**

ä»”ç»†åˆ†æäº†ä¸‹æ¯ä¸€ä¸ªæ­¥éª¤,é€æ­¥æŸ¥æ‰¾é—®é¢˜æ‰€åœ¨
ä»æœ€å¼€å§‹çš„ç›®æ ‡å›¾ç‰‡åƒç´ æ•°æ®å¼€å§‹çœ‹åƒç´ æ•°æ®çš„æ­£ç¡®æ€§,ä½†æ˜¯æ²¡æ‰¾åˆ°é—®é¢˜æ‰€åœ¨,æ•°æ®éƒ½æ²¡å•¥é—®é¢˜,åˆæ­¥åˆ¤æ–­æ˜¯è®¡ç®—åƒç´ å—çš„ä¸»è‰²è°ƒä¸Šå‡ºäº†é—®é¢˜,äºæ˜¯æƒ³åˆ°,ä¼šä¸ä¼šä¸»è‰²è°ƒå¹¶ä¸æ˜¯å–ä¸€å¼ å›¾ç‰‡æˆ–è€…ä¸€å—åƒç´ å—ä¸­å‡ºç°æœ€å¤šæ¬¡æ•°çš„é¢œè‰²ä¸ºä¸»è‰²è°ƒ,è€Œæ˜¯å–å®ƒä»¬çš„æ‰€æœ‰é¢œè‰²çš„å¹³å‡å€¼ä½œä¸ºä¸»è‰²è°ƒå‘¢?  
æƒ³åˆ°è¿™é‡Œ,æˆ‘å¾ˆå…´å¥‹!  
å·®ç‚¹åµé†’å·²ç»ç†Ÿç¡çš„ç“œå¨ƒå­,æˆ‘å¼€å§‹é‡æ–°æ¢³ç†

**è¿™é‡Œ,æˆ‘å¯¹æ¯ä¸ª 8\*8 çš„å°æ–¹å—éƒ½æ”¹æˆäº†é€šè¿‡å¹³å‡å€¼æ±‚ä¸»è‰²è°ƒ**

```JavaScript
//è·å–æ¯ä¸ªæ ¼å­çš„ä¸»è‰²è°ƒ
mostBlockColor(blockList) {
    for (let i = 0; i < blockList.length; i++) {
        let r = 0,
            g = 0,
            b = 0,
            a = 0;
        for (let j = 0; j < blockList[i].color[j].length; j++) {
            r += blockList[i].color[j][0];
            g += blockList[i].color[j][1];
            b += blockList[i].color[j][2];
            a += blockList[i].color[j][3];
        }
        // æ±‚å–å¹³å‡å€¼
        r /= blockList[i].color[0].length;
        g /= blockList[i].color[0].length;
        b /= blockList[i].color[0].length;
        a /= blockList[i].color[0].length;
        // å°†æœ€ç»ˆçš„å€¼å–æ•´
        r = Math.round(r);
        g = Math.round(g);
        b = Math.round(b);
        a = Math.round(a);
        this.blockMainColors.push({
            position: blockList[i].position,
            color: [r, g, b, a],
        });
    }
    console.log(this.blockMainColors);
}
```

**ç„¶å,å¯¹æ¯å¼ å›¾ç‰‡ä¹Ÿæ”¹æˆäº†é€šè¿‡å¹³å‡å€¼æ±‚ä¸»è‰²è°ƒ**

```JavaScript
export function getAverageColor(imgUrl) {
    return new Promise((resolve, reject) => {
        try {
            const canvas = document.createElement("canvas");
            //è®¾ç½®canvasçš„å®½é«˜éƒ½ä¸º20,è¶Šå°è¶Šå¿«,ä½†æ˜¯è¶Šå°è¶Šä¸ç²¾ç¡®
            canvas.width = 20;
            canvas.height = 20;
            const img = new Image(); // åˆ›å»ºimgå…ƒç´ 
            img.src = imgUrl; // è®¾ç½®å›¾ç‰‡æºåœ°å€
            img.onload = () => {
                console.log(img.width, img.height);
                let ctx = canvas.getContext("2d");
                const scaleH = canvas.height / img.height;
                img.height = canvas.height;
                img.width = img.width * scaleH;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                // è·å–åƒç´ æ•°æ®
                let data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                let r = 0,
                    g = 0,
                    b = 0,
                    a = 0;
                // å–æ‰€æœ‰åƒç´ çš„å¹³å‡å€¼
                for (let row = 0; row < canvas.height; row++) {
                    for (let col = 0; col < canvas.width; col++) {
                        r += data[(canvas.width * row + col) * 4];
                        g += data[(canvas.width * row + col) * 4 + 1];
                        b += data[(canvas.width * row + col) * 4 + 2];
                        a += data[(canvas.width * row + col) * 4 + 3];
                    }
                }
                // æ±‚å–å¹³å‡å€¼
                r /= canvas.width * canvas.height;
                g /= canvas.width * canvas.height;
                b /= canvas.width * canvas.height;
                a /= canvas.width * canvas.height;

                // å°†æœ€ç»ˆçš„å€¼å–æ•´
                r = Math.round(r);
                g = Math.round(g);
                b = Math.round(b);
                a = Math.round(a);
                console.log(
                    `%c ${"rgba(" + r + "," + g + "," + b + "," + a + ")"}
                                                                        `,
                    `background: ${"rgba(" + r + "," + g + "," + b + "," + a + ")"};`
                );
                resolve({ color: [r, g, b, a], url: imgUrl });
            };
        } catch (e) {
            reject(e);
        }
    });
}
```

**æ¿€åŠ¨äººå¿ƒçš„æ—¶å€™åˆ°äº†!!!!!!!!!!!!!å•Šå•Šå•Šå•Šå•Š!!æˆ‘å¾ˆæ¿€åŠ¨,èƒœåˆ©å°±åœ¨çœ¼å‰,ä¸´é—¨ä¸€ jor äº†!**

ä¸€é¡¿æ“ä½œ,é€‰æ‹©ç›®æ ‡å›¾ç‰‡,é€‰æ‹©èµ„æºå›¾ç‰‡,ç‚¹å‡»ç”Ÿæˆå›¾ç‰‡æŒ‰é’®å,æˆ‘å¼€å§‹äº†ç­‰å¾…èƒœåˆ©çš„å¬å”¤!

![](https://files.mdnice.com/user/17056/57c7a6cf-3cda-487a-9ba7-9b8d5827e08c.png)

**æˆ‘å»,æ›´ä¸‘äº†,è¿™å’‹å›äº‹**

ç´§æ¥ç€æˆ‘ç›´æ¥çƒ­è¡€äº†èµ·æ¥,é‡åˆ°è¿™ç§æœ‰æŒ‘æˆ˜çš„äº‹æƒ…æˆ‘å°±å¾ˆæœ‰åŠ²å¤´,æˆ‘è¦æä¸è¿‡å®ƒ,é‚£ä¸ç¬¦åˆæˆ‘çš„æ°”è´¨,  
äºæ˜¯æˆ‘å¼€å§‹åˆ†æå¤„ç†è¿‡çš„å°å—ä¸»è‰²è°ƒ,æˆ‘å‘ç°å®ƒä»¬å¥½åƒéƒ½æœ‰è§„å¾‹

![](https://files.mdnice.com/user/17056/04ea1f74-20fe-41df-9e4c-469014b76b23.png)

æˆ‘æƒ³æ˜¯ä»€ä¹ˆå½±å“åˆ°äº†å‘¢,å›¾ç‰‡ç»˜åˆ¶ä¸Šå»ä¸å¯èƒ½ä¼šä¸€æ ·çš„é¢œè‰²å•Š,ä¸€æ ·çš„é¢œè‰²æ˜¯ä»€ä¹ˆå‘¢???

**wo kao~ä¸ä¼šæ˜¯æˆ‘ç”»çš„ 100\*100 çš„çº¿æ¡å§**

äºæ˜¯æˆ‘å›åˆ°,`drawLine`å‡½æ•°,æˆ‘æŠŠå®ƒç»™æ³¨é‡Šæ‰äº†~
![](https://files.mdnice.com/user/17056/d6c67ad8-64c5-46b9-a966-e259550e18a9.gif)
**nice!**
åˆ°è¿™é‡Œ,åŸºæœ¬çš„åŠŸèƒ½å°±å·²ç»å®ç°å•¦~
![](https://files.mdnice.com/user/17056/9617bf11-1dd9-47b0-b4e9-41db87866f77.gif)

**æ¯ä¸€ä¸ªæ–¹å—éƒ½å¯ä»¥äº¤äº’çš„æ‹‰ä¼¸æ—‹è½¬,ç§»åŠ¨**
è¿™ä¸ªæƒ…äººèŠ‚è¿‡çš„,å±å®æ˜¯æœ‰ç‚¹å……å®,ç°åœ¨æ˜¯æ—©ä¸Šå…­ç‚¹åŠ~æˆ‘åˆè‚äº†ä¸€æ³¢,ç¡è§‰ç¡è§‰,ä¿å‘½è¦ç´§,æ™šç‚¹è¿˜è¦å‡ºå»ç© ğŸ˜…ğŸ˜…

## æœ€å

**å‡åä¸€ä¸‹:**

æµªæ¼«çš„ä¸ƒå¤•ï¼Œè¿ç©ºæ°”ä¸­éƒ½é£˜è¡ç€ä¸€è‚¡çˆ±æƒ…çš„å‘³é“ã€‚å¯¹å¯¹æœ‰æƒ…äººæ¬¢å–œç›¸é‚€ï¼Œé»„æ˜åï¼ŒæŸ³æ¢¢å¤´ï¼Œçªƒçªƒç§è¯­ï¼Œè‰¯è¾°ç¾æ™¯ï¼Œæœˆåœ†èŠ±å¥½ï¼ç¥ç¦å¤©ä¸‹æœ‰æƒ…äººï¼Œå¹¸ç¦å¿«ä¹ï¼

è¿™ä¸ªé¡¹ç›®æˆ‘æ”¾åœ¨æˆ‘çš„[github](https://github.com/wangrongding)ä¸Š( https://github.com/wangrongding),å–œæ¬¢çš„å°ä¼™ä¼´,è®°å¾—è¦ç‚¹ä¸ªèµå“¦~

> å¾ˆé«˜å…´å¯ä»¥å’Œå¤§å®¶ä¸€èµ·å˜å¼ºï¼ å¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œå‰åŸ”å¯¨ã€‚æˆ‘ç»„å»ºäº†ä¸€ä¸ªå‰ç«¯æŠ€æœ¯äº¤æµç¾¤,å¦‚æœä½ æƒ³ä¸å¿—åŒé“åˆçš„å°ä¼™ä¼´ä¸€èµ·äº¤æµå­¦ä¹ ï¼Œä¹Ÿå¯ä»¥åŠ æˆ‘ä¸ªäººå¾®ä¿¡ï¼ˆChicSparrowï¼‰ï¼Œæˆ‘æ‹‰ä½ å…¥ç¾¤ä¸€èµ·åŠ æ²¹å§! æˆ‘æ˜¯è£é¡¶ï¼Œå’Œæˆ‘ä¸€èµ·åœ¨é”®å¸½ä¸å­—ç¬¦ä¸Šæ¨ªè·³ï¼Œäºä»£ç å’Œç¨‹åºä¸­ç©¿æ¢­ã€‚ğŸ¦„
